<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>8. 函数式编程 | 路漫漫其修远兮，吾将上下而求索</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="个人展示网站">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.a5fc1f3a.css" as="style"><link rel="preload" href="/assets/js/app.8a9ca17e.js" as="script"><link rel="preload" href="/assets/js/3.c46e8d0c.js" as="script"><link rel="preload" href="/assets/js/1.ae8c2f5c.js" as="script"><link rel="preload" href="/assets/js/14.c44a77a0.js" as="script"><link rel="prefetch" href="/assets/js/10.4efe9ff2.js"><link rel="prefetch" href="/assets/js/100.8e0cb6e9.js"><link rel="prefetch" href="/assets/js/101.5f47d70c.js"><link rel="prefetch" href="/assets/js/102.bfa88ae3.js"><link rel="prefetch" href="/assets/js/103.e1af4b24.js"><link rel="prefetch" href="/assets/js/104.133775e2.js"><link rel="prefetch" href="/assets/js/105.15ad1029.js"><link rel="prefetch" href="/assets/js/106.b22fe8da.js"><link rel="prefetch" href="/assets/js/107.31e56d88.js"><link rel="prefetch" href="/assets/js/108.ab7cd7d9.js"><link rel="prefetch" href="/assets/js/109.82e7201d.js"><link rel="prefetch" href="/assets/js/11.c25e8eb2.js"><link rel="prefetch" href="/assets/js/110.b87ce165.js"><link rel="prefetch" href="/assets/js/111.5efbcb22.js"><link rel="prefetch" href="/assets/js/112.471efefc.js"><link rel="prefetch" href="/assets/js/113.3e1d8418.js"><link rel="prefetch" href="/assets/js/114.347156f8.js"><link rel="prefetch" href="/assets/js/115.3b7273bb.js"><link rel="prefetch" href="/assets/js/116.f22a2bf7.js"><link rel="prefetch" href="/assets/js/117.a2d190a1.js"><link rel="prefetch" href="/assets/js/118.4ded9ace.js"><link rel="prefetch" href="/assets/js/119.9df7c641.js"><link rel="prefetch" href="/assets/js/12.4e78333a.js"><link rel="prefetch" href="/assets/js/120.4ed9f328.js"><link rel="prefetch" href="/assets/js/121.c74b5df8.js"><link rel="prefetch" href="/assets/js/122.fcba6225.js"><link rel="prefetch" href="/assets/js/123.d0ec3ba4.js"><link rel="prefetch" href="/assets/js/124.e1f314f1.js"><link rel="prefetch" href="/assets/js/125.05bd4ef7.js"><link rel="prefetch" href="/assets/js/126.1f796b3a.js"><link rel="prefetch" href="/assets/js/127.1b0246ff.js"><link rel="prefetch" href="/assets/js/128.9d050fef.js"><link rel="prefetch" href="/assets/js/129.6105945f.js"><link rel="prefetch" href="/assets/js/13.50163991.js"><link rel="prefetch" href="/assets/js/130.9b8daf1c.js"><link rel="prefetch" href="/assets/js/131.029cec29.js"><link rel="prefetch" href="/assets/js/132.68c9b4ed.js"><link rel="prefetch" href="/assets/js/133.b1da85f8.js"><link rel="prefetch" href="/assets/js/134.4cce2b2b.js"><link rel="prefetch" href="/assets/js/135.11181ff6.js"><link rel="prefetch" href="/assets/js/136.3c86eae5.js"><link rel="prefetch" href="/assets/js/137.f814d997.js"><link rel="prefetch" href="/assets/js/138.cbba090f.js"><link rel="prefetch" href="/assets/js/139.a96a3668.js"><link rel="prefetch" href="/assets/js/140.a029cbcc.js"><link rel="prefetch" href="/assets/js/141.fdc0c06c.js"><link rel="prefetch" href="/assets/js/142.2cd6f75b.js"><link rel="prefetch" href="/assets/js/143.2d88e8dd.js"><link rel="prefetch" href="/assets/js/144.c9ba6cae.js"><link rel="prefetch" href="/assets/js/145.b2b79665.js"><link rel="prefetch" href="/assets/js/146.22564ba8.js"><link rel="prefetch" href="/assets/js/147.ae420680.js"><link rel="prefetch" href="/assets/js/148.032150c5.js"><link rel="prefetch" href="/assets/js/149.0661a3c8.js"><link rel="prefetch" href="/assets/js/15.549a8f95.js"><link rel="prefetch" href="/assets/js/150.6fb07747.js"><link rel="prefetch" href="/assets/js/151.915c8722.js"><link rel="prefetch" href="/assets/js/152.c135aeb7.js"><link rel="prefetch" href="/assets/js/153.4b006757.js"><link rel="prefetch" href="/assets/js/154.4e39e6a4.js"><link rel="prefetch" href="/assets/js/155.e324a7f8.js"><link rel="prefetch" href="/assets/js/156.872a0cbb.js"><link rel="prefetch" href="/assets/js/157.644ae869.js"><link rel="prefetch" href="/assets/js/158.ea222e83.js"><link rel="prefetch" href="/assets/js/159.471ad720.js"><link rel="prefetch" href="/assets/js/16.a4ab20fc.js"><link rel="prefetch" href="/assets/js/160.c14ccadf.js"><link rel="prefetch" href="/assets/js/161.161ac4a3.js"><link rel="prefetch" href="/assets/js/162.9de74ff7.js"><link rel="prefetch" href="/assets/js/163.7789f841.js"><link rel="prefetch" href="/assets/js/164.bc1ac664.js"><link rel="prefetch" href="/assets/js/165.692a34d3.js"><link rel="prefetch" href="/assets/js/166.e061a461.js"><link rel="prefetch" href="/assets/js/167.7a5282b8.js"><link rel="prefetch" href="/assets/js/168.b44b942a.js"><link rel="prefetch" href="/assets/js/169.a901cacb.js"><link rel="prefetch" href="/assets/js/17.3ba5d3b5.js"><link rel="prefetch" href="/assets/js/170.5acdaea5.js"><link rel="prefetch" href="/assets/js/171.0d84b945.js"><link rel="prefetch" href="/assets/js/172.00e188a4.js"><link rel="prefetch" href="/assets/js/173.839ed5da.js"><link rel="prefetch" href="/assets/js/174.121ecf2e.js"><link rel="prefetch" href="/assets/js/175.845000b8.js"><link rel="prefetch" href="/assets/js/176.a2c15b14.js"><link rel="prefetch" href="/assets/js/177.64e39367.js"><link rel="prefetch" href="/assets/js/178.b1c056c8.js"><link rel="prefetch" href="/assets/js/179.62b40977.js"><link rel="prefetch" href="/assets/js/18.09b5e2bf.js"><link rel="prefetch" href="/assets/js/180.2503707f.js"><link rel="prefetch" href="/assets/js/19.066f4710.js"><link rel="prefetch" href="/assets/js/20.47c6945e.js"><link rel="prefetch" href="/assets/js/21.462b0f16.js"><link rel="prefetch" href="/assets/js/22.95746383.js"><link rel="prefetch" href="/assets/js/23.1aaa0a43.js"><link rel="prefetch" href="/assets/js/24.2811f750.js"><link rel="prefetch" href="/assets/js/25.0a6d1fe6.js"><link rel="prefetch" href="/assets/js/26.271dc36b.js"><link rel="prefetch" href="/assets/js/27.fafb5d89.js"><link rel="prefetch" href="/assets/js/28.cc4e2dfa.js"><link rel="prefetch" href="/assets/js/29.051e1294.js"><link rel="prefetch" href="/assets/js/30.a43fa163.js"><link rel="prefetch" href="/assets/js/31.62a64855.js"><link rel="prefetch" href="/assets/js/32.9dfff69a.js"><link rel="prefetch" href="/assets/js/33.e3fb0fca.js"><link rel="prefetch" href="/assets/js/34.b80328f2.js"><link rel="prefetch" href="/assets/js/35.0aa88a05.js"><link rel="prefetch" href="/assets/js/36.72771fbc.js"><link rel="prefetch" href="/assets/js/37.172f4174.js"><link rel="prefetch" href="/assets/js/38.ce9e668b.js"><link rel="prefetch" href="/assets/js/39.d49e6392.js"><link rel="prefetch" href="/assets/js/4.8714cbf0.js"><link rel="prefetch" href="/assets/js/40.46ab7f6b.js"><link rel="prefetch" href="/assets/js/41.56a35ac7.js"><link rel="prefetch" href="/assets/js/42.1c66c13c.js"><link rel="prefetch" href="/assets/js/43.7aa458de.js"><link rel="prefetch" href="/assets/js/44.972c53e4.js"><link rel="prefetch" href="/assets/js/45.2b74ff10.js"><link rel="prefetch" href="/assets/js/46.0ecfaf72.js"><link rel="prefetch" href="/assets/js/47.174aad12.js"><link rel="prefetch" href="/assets/js/48.08eb2f2c.js"><link rel="prefetch" href="/assets/js/49.01d7a8f1.js"><link rel="prefetch" href="/assets/js/5.4c2909d0.js"><link rel="prefetch" href="/assets/js/50.ce165d41.js"><link rel="prefetch" href="/assets/js/51.2570b51b.js"><link rel="prefetch" href="/assets/js/52.01bbd759.js"><link rel="prefetch" href="/assets/js/53.e7f94643.js"><link rel="prefetch" href="/assets/js/54.4930089a.js"><link rel="prefetch" href="/assets/js/55.da65ad06.js"><link rel="prefetch" href="/assets/js/56.fe2aff78.js"><link rel="prefetch" href="/assets/js/57.0661e140.js"><link rel="prefetch" href="/assets/js/58.aeb0e959.js"><link rel="prefetch" href="/assets/js/59.8b720e29.js"><link rel="prefetch" href="/assets/js/6.bbb54abe.js"><link rel="prefetch" href="/assets/js/60.4a83cc93.js"><link rel="prefetch" href="/assets/js/61.4f2b38a6.js"><link rel="prefetch" href="/assets/js/62.cf18c9ab.js"><link rel="prefetch" href="/assets/js/63.c6b64966.js"><link rel="prefetch" href="/assets/js/64.32cecd04.js"><link rel="prefetch" href="/assets/js/65.410bd788.js"><link rel="prefetch" href="/assets/js/66.6e6e1936.js"><link rel="prefetch" href="/assets/js/67.1aad91a2.js"><link rel="prefetch" href="/assets/js/68.8dc692eb.js"><link rel="prefetch" href="/assets/js/69.307b446d.js"><link rel="prefetch" href="/assets/js/7.761dcbd9.js"><link rel="prefetch" href="/assets/js/70.9b280569.js"><link rel="prefetch" href="/assets/js/71.f4a29662.js"><link rel="prefetch" href="/assets/js/72.05617b8f.js"><link rel="prefetch" href="/assets/js/73.5f9f3ce5.js"><link rel="prefetch" href="/assets/js/74.0ed4c579.js"><link rel="prefetch" href="/assets/js/75.a02dde0f.js"><link rel="prefetch" href="/assets/js/76.3f291ae9.js"><link rel="prefetch" href="/assets/js/77.b5a95948.js"><link rel="prefetch" href="/assets/js/78.3b2c52f1.js"><link rel="prefetch" href="/assets/js/79.7364cccd.js"><link rel="prefetch" href="/assets/js/8.0b37599a.js"><link rel="prefetch" href="/assets/js/80.4865a4b5.js"><link rel="prefetch" href="/assets/js/81.5691c4ea.js"><link rel="prefetch" href="/assets/js/82.af5b833c.js"><link rel="prefetch" href="/assets/js/83.d8f373a5.js"><link rel="prefetch" href="/assets/js/84.c6bcabc5.js"><link rel="prefetch" href="/assets/js/85.4c7f8a2a.js"><link rel="prefetch" href="/assets/js/86.663f8f72.js"><link rel="prefetch" href="/assets/js/87.29bb41b4.js"><link rel="prefetch" href="/assets/js/88.ff7e303e.js"><link rel="prefetch" href="/assets/js/89.b97ce8be.js"><link rel="prefetch" href="/assets/js/9.f9392fda.js"><link rel="prefetch" href="/assets/js/90.24ebf178.js"><link rel="prefetch" href="/assets/js/91.7939bf08.js"><link rel="prefetch" href="/assets/js/92.aba6d344.js"><link rel="prefetch" href="/assets/js/93.9cd39f03.js"><link rel="prefetch" href="/assets/js/94.dbe2b77e.js"><link rel="prefetch" href="/assets/js/95.18161b59.js"><link rel="prefetch" href="/assets/js/96.cebad7e1.js"><link rel="prefetch" href="/assets/js/97.83c38d40.js"><link rel="prefetch" href="/assets/js/98.df826acd.js"><link rel="prefetch" href="/assets/js/99.f6994c7a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5fc1f3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>路漫漫其修远兮，吾将上下而求索</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>一个人可以走的很快，一群人可以走的更远</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>AzureTimez</span>
            
          <span data-v-4e82dffc>2013 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpeg" alt="路漫漫其修远兮，吾将上下而求索" class="logo"> <span class="site-name">路漫漫其修远兮，吾将上下而求索</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/qiankun/" class="nav-link"><i class="undefined"></i>
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/categories/vuepress/" class="nav-link"><i class="undefined"></i>
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/react,antd/" class="nav-link"><i class="undefined"></i>
  react,antd
</a></li><li class="dropdown-item"><!----> <a href="/categories/HTTP/" class="nav-link"><i class="undefined"></i>
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/categories/Rollup/" class="nav-link"><i class="undefined"></i>
  Rollup
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue2/" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/categories/Low Code/" class="nav-link"><i class="undefined"></i>
  Low Code
</a></li><li class="dropdown-item"><!----> <a href="/categories/性能/" class="nav-link"><i class="undefined"></i>
  性能
</a></li><li class="dropdown-item"><!----> <a href="/categories/微前端/" class="nav-link"><i class="undefined"></i>
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/可视化/" class="nav-link"><i class="undefined"></i>
  可视化
</a></li><li class="dropdown-item"><!----> <a href="/categories/TS/" class="nav-link"><i class="undefined"></i>
  TS
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES6/" class="nav-link"><i class="undefined"></i>
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/categories/ssr/" class="nav-link"><i class="undefined"></i>
  ssr
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/weapp/" class="nav-link"><i class="undefined"></i>
  weapp
</a></li><li class="dropdown-item"><!----> <a href="/categories/flutter/" class="nav-link"><i class="undefined"></i>
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/categories/hybrid/" class="nav-link"><i class="undefined"></i>
  hybrid
</a></li><li class="dropdown-item"><!----> <a href="/categories/electron/" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-item"><!----> <a href="/categories/AST/" class="nav-link"><i class="undefined"></i>
  AST
</a></li><li class="dropdown-item"><!----> <a href="/categories/模块化/" class="nav-link"><i class="undefined"></i>
  模块化
</a></li><li class="dropdown-item"><!----> <a href="/categories/gulp/" class="nav-link"><i class="undefined"></i>
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vite/" class="nav-link"><i class="undefined"></i>
  vite
</a></li><li class="dropdown-item"><!----> <a href="/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/categories/canvas/" class="nav-link"><i class="undefined"></i>
  canvas
</a></li><li class="dropdown-item"><!----> <a href="/categories/webGL/" class="nav-link"><i class="undefined"></i>
  webGL
</a></li><li class="dropdown-item"><!----> <a href="/categories/ajax/" class="nav-link"><i class="undefined"></i>
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/categories/fetch/" class="nav-link"><i class="undefined"></i>
  fetch
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/Promise/" class="nav-link"><i class="undefined"></i>
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/categories/GC/" class="nav-link"><i class="undefined"></i>
  GC
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.jpeg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    AzureTimez
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>170</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>44</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/qiankun/" class="nav-link"><i class="undefined"></i>
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/categories/vuepress/" class="nav-link"><i class="undefined"></i>
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/react,antd/" class="nav-link"><i class="undefined"></i>
  react,antd
</a></li><li class="dropdown-item"><!----> <a href="/categories/HTTP/" class="nav-link"><i class="undefined"></i>
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/categories/Rollup/" class="nav-link"><i class="undefined"></i>
  Rollup
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue2/" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/categories/Low Code/" class="nav-link"><i class="undefined"></i>
  Low Code
</a></li><li class="dropdown-item"><!----> <a href="/categories/性能/" class="nav-link"><i class="undefined"></i>
  性能
</a></li><li class="dropdown-item"><!----> <a href="/categories/微前端/" class="nav-link"><i class="undefined"></i>
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/可视化/" class="nav-link"><i class="undefined"></i>
  可视化
</a></li><li class="dropdown-item"><!----> <a href="/categories/TS/" class="nav-link"><i class="undefined"></i>
  TS
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES6/" class="nav-link"><i class="undefined"></i>
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/categories/ssr/" class="nav-link"><i class="undefined"></i>
  ssr
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/weapp/" class="nav-link"><i class="undefined"></i>
  weapp
</a></li><li class="dropdown-item"><!----> <a href="/categories/flutter/" class="nav-link"><i class="undefined"></i>
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/categories/hybrid/" class="nav-link"><i class="undefined"></i>
  hybrid
</a></li><li class="dropdown-item"><!----> <a href="/categories/electron/" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-item"><!----> <a href="/categories/AST/" class="nav-link"><i class="undefined"></i>
  AST
</a></li><li class="dropdown-item"><!----> <a href="/categories/模块化/" class="nav-link"><i class="undefined"></i>
  模块化
</a></li><li class="dropdown-item"><!----> <a href="/categories/gulp/" class="nav-link"><i class="undefined"></i>
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vite/" class="nav-link"><i class="undefined"></i>
  vite
</a></li><li class="dropdown-item"><!----> <a href="/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/categories/canvas/" class="nav-link"><i class="undefined"></i>
  canvas
</a></li><li class="dropdown-item"><!----> <a href="/categories/webGL/" class="nav-link"><i class="undefined"></i>
  webGL
</a></li><li class="dropdown-item"><!----> <a href="/categories/ajax/" class="nav-link"><i class="undefined"></i>
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/categories/fetch/" class="nav-link"><i class="undefined"></i>
  fetch
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/Promise/" class="nav-link"><i class="undefined"></i>
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/categories/GC/" class="nav-link"><i class="undefined"></i>
  GC
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/xw230429/" aria-current="page" class="sidebar-link">前端体系</a></li><li><a href="/docs/xw230429/xw_230429_1.html" class="sidebar-link">1. JavaScript高级用法(1)</a></li><li><a href="/docs/xw230429/xw_230429_2.html" class="sidebar-link">2 JavaScript高级用法(2)</a></li><li><a href="/docs/xw230429/xw_230429_3.html" class="sidebar-link">3 前端异步处理规范及应用</a></li><li><a href="/docs/xw230429/xw_230429_4.html" class="sidebar-link">4 前端模块化</a></li><li><a href="/docs/xw230429/xw_230429_5.html" class="sidebar-link">5. 浏览器事件模型&amp;请求</a></li><li><a href="/docs/xw230429/xw_230429_6.html" class="sidebar-link">6. JavaScript的垃圾回收和内存泄漏</a></li><li><a href="/docs/xw230429/xw_230429_7.html" class="sidebar-link">7. JavaScript的运行机制</a></li><li><a href="/docs/xw230429/xw_230429_8.html" aria-current="page" class="active sidebar-link">8. 函数式编程</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>8. 函数式编程</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>AzureTimez</span>
            
          <span data-v-4e82dffc>2013 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">8. 函数式编程</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>AzureTimez</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2023/6/25</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>JS</span></i></div></div> <div class="theme-reco-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#基础介绍">基础介绍</a></li><li><a href="#一等公民的函数">一等公民的函数</a><ul><li><a href="#概览">概览</a></li><li><a href="#为何函数式一等公民">为何函数式一等公民？</a></li></ul></li><li><a href="#纯函数的好处">纯函数的好处</a><ul><li><a href="#什么是纯函数">什么是纯函数？</a></li></ul></li><li><a href="#副作用内容">副作用内容</a><ul><li><a href="#demo">demo</a></li><li><a href="#追求纯函数的原因">追求纯函数的原因</a></li></ul></li><li><a href="#柯里化">柯里化</a><ul><li><a href="#什么是柯里化-curry-的概念很简单-只传递给函数一部分参数来调用它-让它返回一个函数去处理剩下的参数。你可以一次性地调用-curry-函数-也可以每次只传一个参数分多次调用。">什么是柯里化？curry 的概念很简单：只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数。你可以一次性地调用 curry 函数，也可以每次只传一个参数分多次调用。</a></li><li><a href="#使用用途">使用用途</a></li><li><a href="#测试">测试</a></li></ul></li><li><a href="#代码组合">代码组合</a><ul><li><a href="#什么是代码组合">什么是代码组合？</a></li><li><a href="#pointfree">pointfree</a></li><li><a href="#debug">debug</a></li></ul></li></ul></div><p></p> <h2 id="基础介绍"><a href="#基础介绍" class="header-anchor">#</a> 基础介绍</h2> <p>以下是一个海鸥程序，鸟群合并则可以变成了一个更大的鸟群，繁殖则增加了鸟群的数量，增加的数量就是它们繁殖出来的海鸥的数量。</p> <blockquote><p>注意这个程序并不是面向对象的良好实践，它只是强调当前这种变量赋值方式的一些弊端。
​</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">Flock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>seagulls <span class="token operator">=</span> n
<span class="token punctuation">}</span>

<span class="token class-name">Flock</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">conjoin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>seagulls <span class="token operator">+=</span> other<span class="token punctuation">.</span>seagulls
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token class-name">Flock</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">breed</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>seagulls <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>seagulls <span class="token operator">*</span> other<span class="token punctuation">.</span>seagulls
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> flock_a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flock</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> flock_b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flock</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> flock_c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flock</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> flock_a<span class="token punctuation">.</span><span class="token function">conjoin</span><span class="token punctuation">(</span>flock_c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">breed</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">conjoin</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">.</span><span class="token function">breed</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>seagulls
<span class="token comment">//=&gt; 32</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>按照实现的预期，我们期望答案是16，但是输出的结果却是32，这样的代码形式会使得代码的内部状态变得非常难以追踪，错误的原因在于 flock_a 在运算过程中永久地改变了。</p> <p>再换一种方式：
​</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">conjoin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">flock_x<span class="token punctuation">,</span> flock_y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> flock_x <span class="token operator">+</span> flock_y <span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">breed</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">flock_x<span class="token punctuation">,</span> flock_y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> flock_x <span class="token operator">*</span> flock_y <span class="token punctuation">}</span>

<span class="token keyword">var</span> flock_a <span class="token operator">=</span> <span class="token number">4</span>
<span class="token keyword">var</span> flock_b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">var</span> flock_c <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">conjoin</span><span class="token punctuation">(</span><span class="token function">breed</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">,</span> <span class="token function">conjoin</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">breed</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_b<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>虽然得到了正确的答案，而且少写了很多代码。但函数嵌套有点让人费解，不过代码肯定是越直白越好，所以如果我们再深入挖掘，我们会发现，它不过是在进行简单的加（conjoin） 和乘（breed）运算而已。</p> <p>代码中的两个函数除了函数名有些特殊，其他没有任何难以理解的地方。我们把它们重命名一下，看看它们的真实功能。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">*</span> y <span class="token punctuation">}</span>

<span class="token keyword">var</span> flock_a <span class="token operator">=</span> <span class="token number">4</span>
<span class="token keyword">var</span> flock_b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">var</span> flock_c <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;16</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​
这样，我们会发现，我们所做的无非是简单的加减乘除：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 结合律（assosiative）</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 交换律（commutative）</span>
<span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">add</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span>

<span class="token comment">// 同一律（identity）</span>
<span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> x

<span class="token comment">// 分配律（distributive）</span>
<span class="token function">multiply</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​
基于此，我们可以针对原有代码进行处理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 原有代码</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_b<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 应用同一律，去掉多余的加法操作（add(flock_a, flock_c) == flock_a）</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">,</span> flock_a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_b<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 再应用分配律</span>
<span class="token function">multiply</span><span class="token punctuation">(</span>flock_b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>flock_a<span class="token punctuation">,</span> flock_a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​
这样，我们就可以通过简单的函数逻辑调整，优化了绝大多数的代码量，只需要定义好add和multiply即可。</p> <h2 id="一等公民的函数"><a href="#一等公民的函数" class="header-anchor">#</a> 一等公民的函数</h2> <h3 id="概览"><a href="#概览" class="header-anchor">#</a> 概览</h3> <p>函数是“一等公民”实际上说的是它们和其他对象都一样...所以就是普通公民（坐经济舱的人？）。换句话说，函数没什么特殊的，你可以像对待任何其他数据类型一样对待它们——把它们存在数组里，当作参数传递，赋值给变量...等等。</p> <p>这是 JavaScript 语言的基础概念，不过还是值得提一提的，大多数人对这个概念集体无视，或者也可能是无知。我们来看一个杜撰的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">hi</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> <span class="token function-variable function">greeting</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​
这里<code>greeting</code>指向的那个把<code>hi</code>包了一层的包裹函数完全是多余的。为什么？因为 JavaScript 的函数是可调用的，当<code>hi</code>后面紧跟 () 的时候就会运行并返回一个值；如果没有 ()，hi 就简单地返回存到这个变量里的函数。我们来确认一下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>hi <span class="token comment">// name =&gt; `Hi ${name}`</span>
<span class="token function">hi</span><span class="token punctuation">(</span><span class="token string">&quot;jonas&quot;</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hi jonas&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​
<code>greeting</code>只不过是转了个身然后以相同的参数调用了 hi 函数而已，因此我们可以这么写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> greeting <span class="token operator">=</span> hi
<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">&quot;times&quot;</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hi times&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​
换句话说，hi 已经是个接受一个参数的函数了，而它仅仅是用这个相同的参数调用 hi，这样完全多此一举。<br>
用一个函数把另一个函数包起来，目的仅仅是延迟执行，真的是非常糟糕的编程习惯。<br>
接下来看几个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">const</span> <span class="token function-variable function">getServerStuff</span> <span class="token operator">=</span> <span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">ajaxCall</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// good</span>
<span class="token keyword">const</span> getServerStuff <span class="token operator">=</span> ajaxCall
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​
等同于</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">ajaxCall</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 等价于</span>
<span class="token function">ajaxCall</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

<span class="token comment">// 那么，重构下 getServerStuff</span>
<span class="token keyword">const</span> <span class="token function-variable function">getServerStuff</span> <span class="token operator">=</span> <span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">ajaxCall</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

<span class="token comment">// ...就等于</span>
<span class="token keyword">const</span> getServerStuff <span class="token operator">=</span> ajaxCall <span class="token comment">// &lt;-- 看，没有括号哦</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​
所以以上才是写函数的正确方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">index</span><span class="token punctuation">(</span><span class="token parameter">posts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Views<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Views<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">post<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>post<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
这个Controller99% 的代码都是垃圾，可以重写为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>
  index<span class="token operator">:</span> Views<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
  show<span class="token operator">:</span> Views<span class="token punctuation">.</span>show<span class="token punctuation">,</span>
  create<span class="token operator">:</span> Db<span class="token punctuation">.</span>create<span class="token punctuation">,</span>
  update<span class="token operator">:</span> Db<span class="token punctuation">.</span>update<span class="token punctuation">,</span>
  destroy<span class="token operator">:</span> Db<span class="token punctuation">.</span>destroy<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
或者直接全部删掉，因为它的作用仅仅就是把视图（Views）和数据库（Db）打包在一起而已。</p> <h3 id="为何函数式一等公民"><a href="#为何函数式一等公民" class="header-anchor">#</a> 为何函数式一等公民？</h3> <p>回顾下前面的代码，<code>getServerStuff</code>和<code>BlogController</code>，虽说添加一些没有实际用处的间接层实现起来很容易，但这样做除了徒增代码量，提高维护和检索代码的成本外，没有任何用处。</p> <p>另外，如果一个函数被不必要地包裹起来了，而且发生了改动，那么包裹它的那个函数也要做相应的变更。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> <span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">renderPost</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​
如果 httpGet 要改成可以抛出一个可能出现的 err 异常，那我们还要回过头去把“胶水”函数也改了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 把整个应用里的所有 httpGet 调用都改成这样，可以传递 err 参数。</span>
<span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">json<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">renderPost</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​
写成一等公民函数的形式，要做的改动将会少得多：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> renderPost<span class="token punctuation">)</span>  <span class="token comment">// renderPost 将会在 httpGet 中调用，想要多少参数都行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​
除了删除不必要的函数，正确地为参数命名也必不可少。当然命名不是什么大问题，但还是有可能存在一些不当的命名，尤其随着代码量的增长以及需求的变更，这种可能性也会增加。<br>
项目中常见的一种造成混淆的原因是，针对同一个概念使用不同的命名。还有通用代码的问题。比如，下面这两个函数做的事情一模一样，但后一个就显得更加通用，可重用性也更高：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 只针对当前的博客</span>
<span class="token keyword">const</span> <span class="token function-variable function">validArticles</span> <span class="token operator">=</span> <span class="token parameter">articles</span> <span class="token operator">=&gt;</span>
  articles<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">article</span> <span class="token operator">=&gt;</span> article <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> article <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">// 对未来的项目更友好</span>
<span class="token keyword">const</span> <span class="token function-variable function">compact</span> <span class="token operator">=</span> <span class="token parameter">xs</span> <span class="token operator">=&gt;</span> xs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​
在命名的时候，我们特别容易把自己限定在特定的数据上（本例中是<code>articles</code>）。这种现象很常见，也是重复造轮子的一大原因。</p> <p>有一点我必须得指出，你一定要非常小心 this 值，这一点与面向对象代码类似。如果一个底层函数使用了 this，而且是以一等公民的方式被调用的，那就很容易掉进this的坑里（课上代码已经讲的足够多了）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// bad</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'freaky_friday.txt'</span><span class="token punctuation">,</span> Db<span class="token punctuation">.</span>save<span class="token punctuation">)</span>

<span class="token comment">// good a little</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'freaky_friday.txt'</span><span class="token punctuation">,</span> Db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>Db<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
把 Db 绑定（bind）到它自己身上以后，你就可以随心所欲地调用它的原型链式了。</p> <blockquote><p>this 有利有弊，如果不熟悉，尽量避免使用它，因为在函数式编程中根本用不到它。然而，在使用其他的类库时，可能会发现各种各样关于this的使用。</p></blockquote> <h2 id="纯函数的好处"><a href="#纯函数的好处" class="header-anchor">#</a> 纯函数的好处</h2> <h3 id="什么是纯函数"><a href="#什么是纯函数" class="header-anchor">#</a> 什么是纯函数？</h3> <blockquote><p>纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。</p></blockquote> <p>比如数组的<code>slice</code>和<code>splice</code>，这两个函数的作用并无二致——但是注意，它们各自的方式却大不同，但不管怎么说作用还是一样的。</p> <ul><li><code>slice</code>符合纯函数的定义：因为对相同的输入它保证能返回相同的输出；</li> <li><code>splice</code>却不同：会产生可观察到的副作用，即这个数组永久地改变了；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>

<span class="token comment">// 纯的</span>
xs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; [1,2,3]</span>

xs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; [1,2,3]</span>

xs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; [1,2,3]</span>


<span class="token comment">// 不纯的</span>
xs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; [1,2,3]</span>

xs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; [4,5]</span>

xs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; []</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>​
在函数式编程中，我们追求的是那种可靠的，每次都能返回同样结果的函数，而不是像 splice 这样每次调用后都把数据弄得一团糟的函数。</p> <p>来看看另一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 不纯的</span>
<span class="token keyword">var</span> minimum <span class="token operator">=</span> <span class="token number">21</span>

<span class="token keyword">var</span> <span class="token function-variable function">checkAge</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> minimum
<span class="token punctuation">}</span>


<span class="token comment">// 纯的</span>
<span class="token keyword">var</span> <span class="token function-variable function">checkAge</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> minimum <span class="token operator">=</span> <span class="token number">21</span>
  <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> minimum
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​
在不纯的版本中，<code>checkAge</code>的结果将取决于<code>minimum</code>这个可变变量的值。换句话说，它取决于系统状态（<code>system state</code>）；因为它引入了外部的环境，从而增加了认知负荷（<code>cognitive load</code>）。<br>
这个例子可能还不是那么明显，但这种依赖状态是影响系统复杂度的<a href="http://www.curtclifton.net/storage/papers/MoseleyMarks06a.pdf" target="_blank" rel="noopener noreferrer">罪魁祸首<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。输入值之外的因素能够左右 checkAge 的返回值，不仅让它变得不纯，而且导致每次我们思考整个软件的时候都痛苦不堪。<br>
另一方面，使用纯函数的形式，函数就能做到自给自足。我们也可以让<code>minimum</code>成为一个不可变（<code>immutable</code>）对象，这样就能保留纯粹性，因为状态不会有变化。要实现这个效果，必须得创建一个对象，然后调用<code>Object.freeze</code>方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> immutableState <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  minimum<span class="token operator">:</span> <span class="token number">21</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​</p> <h2 id="副作用内容"><a href="#副作用内容" class="header-anchor">#</a> 副作用内容</h2> <p>“副作用”的关键部分在于“副”。就像一潭死水中的“水”本身并不是幼虫的培养器，“死”才是生成虫群的原因。同理，副作用中的“副”是滋生 bug 的温床。</p> <p>副作用是在计算结果的过程中，系统状态的一种变化，或者与外部世界进行的可观察的交互。</p> <p>副作用可能包含，但不限于：</p> <ol><li>更改文件系统；</li> <li>往数据库插入记录；</li> <li>发送一个 http 请求；</li> <li>可变数据；</li> <li>打印/log；</li> <li>获取用户输入；</li> <li>DOM 查询；</li> <li>访问系统状态...</li></ol> <p>概括来讲，只要是跟函数外部环境发生的交互就都是副作用——这一点可能会让你怀疑无副作用编程的可行性。函数式编程的哲学就是假定副作用是造成不正当行为的主要原因。</p> <p>这并不是说，要禁止使用一切副作用，而是说，要让它们在可控的范围内发生。</p> <p>副作用让一个函数变得不纯是有道理的：从定义上来说，纯函数必须要能够根据相同的输入返回相同的输出；如果函数需要跟外部事物打交道，那么就无法保证这一点了。</p> <h3 id="demo"><a href="#demo" class="header-anchor">#</a> demo</h3> <p>函数是两种数值之间的关系：输入和输出。尽管每个输入都只会有一个输出，但不同的输入却可以有相同的输出。下图展示了一个合法的从 x 到 y 的函数关系；</p> <p><img src="data:image/png;base64,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" alt="alt 8-1"></p> <p>下面这张图表展示的就不是一种函数关系，因为输入值 5 指向了多个输出：</p> <p><img src="data:image/png;base64,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" alt="alt 8-2"></p> <p>函数可以描述为一个集合，这个集合里的内容是 (输入, 输出) 对：[(1,2), (3,6), (5,10)]。</p> <p>或者：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> toLowerCase <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;A&quot;</span><span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;E&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">}</span>

toLowerCase<span class="token punctuation">[</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">]</span>
<span class="token comment">//=&gt; &quot;c&quot;</span>

<span class="token keyword">var</span> isPrime <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span>

isPrime<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token comment">//=&gt; true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​
当然实际情况中，可能需要进行一些计算而不是手动指定各项值；不过上例倒是表明了另外一种思考函数的方式。<br>
从数学的概念上将，纯函数就是数学上的函数，而且是函数式编程的全部。使用这些纯函数编程能够带来大量的好处，让我们来看一下为何要不遗余力地保留函数的纯粹性的原因。</p> <h3 id="追求纯函数的原因"><a href="#追求纯函数的原因" class="header-anchor">#</a> 追求纯函数的原因</h3> <h4 id="可缓存性-cacheable"><a href="#可缓存性-cacheable" class="header-anchor">#</a> 可缓存性（Cacheable）</h4> <p>首先，纯函数总能够根据输入来做缓存。实现缓存的一种典型方式是<code>memoize</code>技术：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> squareNumber  <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 16</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 从缓存中读取输入值为 4 的结果</span>
<span class="token comment">//=&gt; 16</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 25</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 从缓存中读取输入值为 5 的结果</span>
<span class="token comment">//=&gt; 25</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">memoize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arg_str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
    cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span> <span class="token operator">=</span> cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​
值得注意的一点是，可以通过延迟执行的方式把不纯的函数转换为纯函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> pureHttpCall <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
这里有趣的地方在于我们并没有真正发送 http 请求——只是返回了一个函数，当调用它的时候才会发请求。这个函数之所以有资格成为纯函数，是因为它总是会根据相同的输入返回相同的输出：给定了 url 和 params 之后，它就只会返回同一个发送 http 请求的函数。
<code>memoize</code>函数工作起来没有任何问题，虽然它缓存的并不是 http 请求所返回的结果，而是生成的函数。</p> <h4 id="可移植性-自文档化-portable-self-documenting"><a href="#可移植性-自文档化-portable-self-documenting" class="header-anchor">#</a> 可移植性／自文档化（Portable / Self-Documenting）</h4> <p>纯函数是完全自给自足的，它需要的所有东西都能轻易获得。仔细思考思考这一点...这种自给自足的好处是什么呢？首先，纯函数的依赖很明确，因此更易于观察和理解。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 不纯的</span>
<span class="token keyword">var</span> <span class="token function-variable function">signUp</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token function">saveUser</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>
  <span class="token function">welcomeUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">saveUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">welcomeUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Email</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 纯的</span>
<span class="token keyword">var</span> <span class="token function-variable function">signUp</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Db<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token function">saveUser</span><span class="token punctuation">(</span>Db<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span>
    <span class="token function">welcomeUser</span><span class="token punctuation">(</span>Email<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">saveUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Db<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">welcomeUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Email<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>​
这个例子表明，纯函数对于其依赖必须要明确，这样我们就能知道它的目的。<br>
仅从纯函数版本的<code>signUp</code>的签名就可以看出，它将要用到<code>Db</code>、<code>Email</code>和<code>attrs</code>，这在最小程度上给了我们足够多的信息。<br>
其次，通过强迫“注入”依赖，或者把它们当作参数传递，我们的应用也更加灵活；因为数据库或者邮件客户端等等都参数化了。如果要使用另一个<code>Db</code>，只需把它传给函数就行了。如果想在一个新应用中使用这个可靠的函数，尽管把新的<code>Db</code>和<code>Email</code>传递过去就好了，非常简单。<br>
命令式编程中“典型”的方法和过程都深深地根植于它们所在的环境中，通过状态、依赖和有效作用（<code>available effects</code>）达成；纯函数与此相反，它与环境无关，只要我们愿意，可以在任何地方运行它。</p> <h4 id="可测试性-testable"><a href="#可测试性-testable" class="header-anchor">#</a> 可测试性（Testable）</h4> <p>纯函数让测试更加容易。我们不需要伪造一个“真实的”支付网关，或者每一次测试之前都要配置、之后都要断言状态（<code>assert the state</code>）。只需简单地给函数一个输入，然后断言输出就好了。</p> <h4 id="合理性-reasonable"><a href="#合理性-reasonable" class="header-anchor">#</a> 合理性（Reasonable）</h4> <p>很多人相信使用纯函数最大的好处是引用透明性（referential transparency）。如果一段代码可以替换成它执行所得的结果，而且是在不改变整个程序行为的前提下替换的，那么我们就说这段代码是引用透明的。</p> <p>由于纯函数总是能够根据相同的输入返回相同的输出，所以它们就能够保证总是返回同一个结果，这也就保证了引用透明性。</p> <p>我们来看一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> Immutable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'immutable'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token function-variable function">decrementHP</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> player<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hp&quot;</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>hp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">isSameTeam</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player1<span class="token punctuation">,</span> player2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> player1<span class="token punctuation">.</span>team <span class="token operator">===</span> player2<span class="token punctuation">.</span>team
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">punch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isSameTeam</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">decrementHP</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> jobe <span class="token operator">=</span> Immutable<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;Jobe&quot;</span><span class="token punctuation">,</span> hp<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> team<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> michael <span class="token operator">=</span> Immutable<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">,</span> hp<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> team<span class="token operator">:</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">punch</span><span class="token punctuation">(</span>jobe<span class="token punctuation">,</span> michael<span class="token punctuation">)</span>
<span class="token comment">//=&gt; Immutable.Map({name:&quot;Michael&quot;, hp:19, team: &quot;green&quot;})</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>​
<code>decrementHP</code>、<code>isSameTeam</code>和<code>punch</code>都是纯函数，所以是引用透明的。我们可以使用一种叫做“等式推导”（<code>equational reasoning</code>）的方法来分析代码。所谓“等式推导”就是“一对一”替换，有点像在不考虑程序性执行的怪异行为（<code>quirks of programmatic evaluation</code>）的情况下，手动执行相关代码。我们借助引用透明性来剖析一下这段代码。</p> <p>首先内联<code>isSameTeam</code>函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">punch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>team <span class="token operator">===</span> target<span class="token punctuation">.</span>team<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">decrementHP</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
因为是不可变数据，我们可以直接把 team 替换为实际值：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">punch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span> <span class="token operator">===</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">decrementHP</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
if 语句执行结果为 false，所以可以把整个 if 语句都删掉：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">punch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">decrementHP</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
如果再内联<code>decrementHP</code>，我们会发现这种情况下，punch 变成了一个让 hp 的值减 1 的调用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">punch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hp&quot;</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>hp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
等式推导带来的分析代码的能力对重构和理解代码非常重要。事实上，我们重构海鸥程序使用的正是这项技术：利用加和乘的特性。</p> <h4 id="并行代码"><a href="#并行代码" class="header-anchor">#</a> 并行代码</h4> <p>最后一点，也是决定性的一点：我们可以并行运行任意纯函数。因为纯函数根本不需要访问共享的内存，而且根据其定义，纯函数也不会因副作用而进入竞争态（<code>race condition</code>）。</p> <p>并行代码在服务端 js 环境以及使用了 web worker 的浏览器那里是非常容易实现的，因为它们使用了线程（thread）。不过出于对非纯函数复杂度的考虑，当前主流观点还是避免使用这种并行。</p> <h2 id="柯里化"><a href="#柯里化" class="header-anchor">#</a> 柯里化</h2> <h3 id="什么是柯里化-curry-的概念很简单-只传递给函数一部分参数来调用它-让它返回一个函数去处理剩下的参数。你可以一次性地调用-curry-函数-也可以每次只传一个参数分多次调用。"><a href="#什么是柯里化-curry-的概念很简单-只传递给函数一部分参数来调用它-让它返回一个函数去处理剩下的参数。你可以一次性地调用-curry-函数-也可以每次只传一个参数分多次调用。" class="header-anchor">#</a> 什么是柯里化？curry 的概念很简单：只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数。你可以一次性地调用 curry 函数，也可以每次只传一个参数分多次调用。</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> increment <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> addTen <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 3</span>

<span class="token function">addTen</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 12</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>​
这里我们定义了一个 add 函数，它接受一个参数并返回一个新的函数。调用 add 之后，返回的函数就通过闭包的方式记住了 add 的第一个参数。一次性地调用它实在是有点繁琐，好在我们可以使用一个特殊的 curry 帮助函数（<code>helper function</code>）使这类函数的定义和调用更加容易。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> curry <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>curry

<span class="token keyword">var</span> match <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">what<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>what<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> replace <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">what<span class="token punctuation">,</span> replacement<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>what<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> filter <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> ary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ary<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> ary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ary<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>​
在上面的代码中遵循的是一种简单，同时也非常重要的模式。即策略性地把要操作的数据（String， Array）放到最后一个参数里。到使用它们的时候你就明白这样做的原因是什么了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// [ ' ' ]</span>

<span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// [ ' ' ]</span>

<span class="token keyword">var</span> hasSpaces <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span>
<span class="token comment">// function(x) { return x.match(/\s+/g) }</span>

<span class="token function">hasSpaces</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// [ ' ' ]</span>

<span class="token function">hasSpaces</span><span class="token punctuation">(</span><span class="token string">&quot;spaceless&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// null</span>

<span class="token function">filter</span><span class="token punctuation">(</span>hasSpaces<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tori_spelling&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tori amos&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// [&quot;tori amos&quot;]</span>

<span class="token keyword">var</span> findSpaces <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>hasSpaces<span class="token punctuation">)</span>
<span class="token comment">// function(xs) { return xs.filter(function(x) { return x.match(/\s+/g) }) }</span>

<span class="token function">findSpaces</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;tori_spelling&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tori amos&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// [&quot;tori amos&quot;]</span>

<span class="token keyword">var</span> noVowels <span class="token operator">=</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[aeiou]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">)</span>
<span class="token comment">// function(replacement, x) { return x.replace(/[aeiou]/ig, replacement) }</span>

<span class="token keyword">var</span> censored <span class="token operator">=</span> <span class="token function">noVowels</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// function(x) { return x.replace(/[aeiou]/ig, &quot;*&quot;) }</span>

<span class="token function">censored</span><span class="token punctuation">(</span><span class="token string">&quot;Chocolate Rain&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 'Ch*c*l*t* R**n'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>​
这里表明的是一种“预加载”函数的能力，通过传递一到两个参数调用函数，就能得到一个记住了这些参数的新函数。</p> <h3 id="使用用途"><a href="#使用用途" class="header-anchor">#</a> 使用用途</h3> <p>curry 的用处非常广泛，就像在<code>hasSpaces</code>、<code>findSpaces</code>和<code>censored</code>看到的那样，只需传给函数一些参数，就能得到一个新函数。</p> <p>用 map 简单地把参数是单个元素的函数包裹一下，就能把它转换成参数为数组的函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">getChildren</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token punctuation">.</span>childNodes
<span class="token punctuation">}</span>

<span class="token keyword">var</span> allTheChildren <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>getChildren<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>只传给函数一部分参数通常也叫做局部调用（<code>partial application</code>），能够大量减少样板文件代码（boilerplate code）。考虑上面的 allTheChildren 函数，如果用 lodash 的普通 map 来写会是什么样的（注意参数的顺序也变了）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">allTheChildren</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elements</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> getChildren<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
通常我们不定义直接操作数组的函数，因为只需内联调用<code>map(getChildren)</code>就能达到目的。这一点同样适用于 sort、filter 以及其他的高阶函数（<code>higher order function</code>）（高阶函数：参数或返回值为函数的函数）。</p> <p>当我们谈论纯函数的时候，我们说它们接受一个输入返回一个输出。curry 函数所做的正是这样：每传递一个参数调用函数，就返回一个新函数处理剩余的参数。这就是一个输入对应一个输出啊。</p> <p>哪怕输出是另一个函数，它也是纯函数。当然 curry 函数也允许一次传递多个参数，但这只是出于减少 () 的方便。</p> <h3 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ramda'</span><span class="token punctuation">)</span>


<span class="token comment">// 练习 1</span>
<span class="token comment">//==============</span>
<span class="token comment">// 通过局部调用（partial apply）移除所有参数</span>

<span class="token keyword">var</span> <span class="token function-variable function">words</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 练习 1a</span>
<span class="token comment">//==============</span>
<span class="token comment">// 使用 `map` 创建一个新的 `words` 函数，使之能够操作字符串数组</span>

<span class="token keyword">var</span> sentences <span class="token operator">=</span> <span class="token keyword">undefined</span>


<span class="token comment">// 练习 2</span>
<span class="token comment">//==============</span>
<span class="token comment">// 通过局部调用（partial apply）移除所有参数</span>

<span class="token keyword">var</span> <span class="token function-variable function">filterQs</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">q</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>  
  <span class="token punctuation">}</span><span class="token punctuation">,</span> xs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 练习 3</span>
<span class="token comment">//==============</span>
<span class="token comment">// 使用帮助函数 `_keepHighest` 重构 `max` 使之成为 curry 函数</span>

<span class="token comment">// 无须改动:</span>
<span class="token keyword">var</span> <span class="token function-variable function">_keepHighest</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">&gt;=</span> y <span class="token operator">?</span> x <span class="token operator">:</span> y <span class="token punctuation">}</span>

<span class="token comment">// 重构这段代码:</span>
<span class="token keyword">var</span> <span class="token function-variable function">max</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_keepHighest</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">Infinity</span><span class="token punctuation">,</span> xs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 彩蛋 1:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 包裹数组的 `slice` 函数使之成为 curry 函数</span>
<span class="token comment">// //[1,2,3].slice(0, 2)</span>
<span class="token keyword">var</span> slice <span class="token operator">=</span> <span class="token keyword">undefined</span>


<span class="token comment">// 彩蛋 2:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 借助 `slice` 定义一个 `take` curry 函数，该函数调用后可以取出字符串的前 n 个字符。</span>
<span class="token keyword">var</span> take <span class="token operator">=</span> <span class="token keyword">undefined</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>代码见课后习题；</p> <h2 id="代码组合"><a href="#代码组合" class="header-anchor">#</a> 代码组合</h2> <h3 id="什么是代码组合"><a href="#什么是代码组合" class="header-anchor">#</a> 什么是代码组合？</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span>g</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​
f 和 g 都是函数，x 是在它们之间通过“管道”传输的值。</p> <p>组合看起来像是在饲养函数。你就是饲养员，选择两个有特点又遭你喜欢的函数，让它们结合，产下一个崭新的函数。组合的用法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">var</span> <span class="token function-variable function">toUpperCase</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">exclaim</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token string">'!'</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> shout <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">)</span>

<span class="token function">shout</span><span class="token punctuation">(</span><span class="token string">&quot;send in the clowns&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; &quot;SEND IN THE CLOWNS!&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
代码组合：两个函数组合之后返回了一个新函数，也就是组合某种类型（本例中是函数）的两个元素本就该生成一个该类型的新元素。</p> <p>在<code>compose</code>的定义中，g 将先于 f 执行，因此就创建了一个从右到左的数据流。这样做的可读性远远高于嵌套一大堆的函数调用，如果不用组合，shout 函数将会是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">shout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">exclaim</span><span class="token punctuation">(</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​
让代码从右向左运行，而不是由内而外运行，我们来看一个顺序很重要的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">head</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> reverse <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jumpkick'</span><span class="token punctuation">,</span> <span class="token string">'roundhouse'</span><span class="token punctuation">,</span> <span class="token string">'uppercut'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 'uppercut'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​
<code>reverse</code>反转列表，<code>head</code>取列表中的第一个元素；所以结果就是得到了一个 last 函数（译者注：即取列表的最后一个元素），虽然它性能不高。这个组合中函数的执行顺序应该是显而易见的。尽管我们可以定义一个从左向右的版本，但是从右向左执行更加能够反映数学上的含义。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 结合律（associativity）</span>
<span class="token keyword">var</span> associative <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
意味着不管你是把 g 和 h 分到一组，还是把 f 和 g 分到一组都不重要。所以，如果我们想把字符串变为大写，可以这么写：
​</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span>toUpperCase<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 或者</span>
<span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>因为如何为<code>compose</code>的调用分组不重要，所以结果都是一样的。这也让我们有能力写一个可变的组合（<code>variadic compose</code>），用法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 前面的例子中我们必须要写两个组合才行，但既然组合是符合结合律的，我们就可以只写一个，</span>
<span class="token comment">// 而且想传给它多少个函数就传给它多少个，然后让它自己决定如何分组。</span>

<span class="token keyword">var</span> lastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token function">lastUpper</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jumpkick'</span><span class="token punctuation">,</span> <span class="token string">'roundhouse'</span><span class="token punctuation">,</span> <span class="token string">'uppercut'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 'UPPERCUT'</span>


<span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token function">loudLastUpper</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jumpkick'</span><span class="token punctuation">,</span> <span class="token string">'roundhouse'</span><span class="token punctuation">,</span> <span class="token string">'uppercut'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 'UPPERCUT!'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​
运用结合律能为我们带来强大的灵活性，而且你也可以在类似<a href="https://lodash.com/" target="_blank" rel="noopener noreferrer">lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="http://underscorejs.org/" target="_blank" rel="noopener noreferrer">underscore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 以及<a href="https://ramdajs.com/" target="_blank" rel="noopener noreferrer">ramda<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这样的类库中找到它们的常规定义。</p> <p>结合律的一大好处是任何一个函数分组都可以被拆开来，然后再以它们自己的组合方式打包在一起。让我们来重构重构前面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token comment">// 或</span>
<span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
<span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">,</span> last<span class="token punctuation">)</span>

<span class="token comment">// 或</span>
<span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
<span class="token keyword">var</span> angry <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">)</span>
<span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>angry<span class="token punctuation">,</span> last<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​</p> <h3 id="pointfree"><a href="#pointfree" class="header-anchor">#</a> pointfree</h3> <p>pointfree 模式指的是，永远不必说出你的数据。它的意思是说，函数无须提及将要操作的数据是什么样的。一等公民的函数、柯里化（curry）以及组合协作起来非常有助于实现这种模式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 非 pointfree，因为提到了数据：word</span>
<span class="token keyword">var</span> <span class="token function-variable function">snakeCase</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// pointfree</span>
<span class="token keyword">var</span> snakeCase <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toLowerCase<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​
这里所做的事情就是通过管道把数据在接受单个参数的函数间传递。利用 curry，我们能够做到让每个函数都先接收数据，然后操作数据，最后再把数据传递到下一个函数那里去。另外注意在 pointfree 版本中，不需要 word 参数就能构造函数；而在非 pointfree 的版本中，必须要有 word 才能进行一切操作。</p> <p>再来看一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 非 pointfree，因为提到了数据：name</span>
<span class="token keyword">var</span> <span class="token function-variable function">initials</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// pointfree</span>
<span class="token keyword">var</span> initials <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">initials</span><span class="token punctuation">(</span><span class="token string">&quot;hunter stockton thompson&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 'H. S. T'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​
pointfree 模式能够帮助我们减少不必要的命名，让代码保持简洁和通用。对函数式代码来说，pointfree 是非常好的石蕊试验，因为它能告诉我们一个函数是否是接受输入返回输出的小函数。比如，while 循环是不能组合的。不过你也要警惕，pointfree 就像是一把双刃剑，有时候也能混淆视听。并非所有的函数式代码都是 pointfree 的，不过这没关系。可以使用它的时候就使用，不能使用的时候就用普通函数。</p> <h3 id="debug"><a href="#debug" class="header-anchor">#</a> debug</h3> <p>组合的一个常见错误是，在没有局部调用之前，就组合类似 map 这样接受两个参数的函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 错误做法：我们传给了 `angry` 一个数组，根本不知道最后传给 `map` 的是什么东西。</span>
<span class="token keyword">var</span> latin <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> angry<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token function">latin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;frog&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;eyes&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// error</span>


<span class="token comment">// 正确做法：每个函数都接受一个实际参数。</span>
<span class="token keyword">var</span> latin <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>angry<span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token function">latin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;frog&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;eyes&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// [&quot;EYES!&quot;, &quot;FROG!&quot;])</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>​
如果在 debug 组合的时候遇到了困难，那么可以使用下面这个实用的，但是不纯的 trace 函数来追踪代码的执行情况。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> trace <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
  <span class="token keyword">return</span> x
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toLower<span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{2,}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token string">'The world is a vampire'</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: Cannot read property 'apply' of undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​
toLower 的参数是一个数组，所以需要先用 map 调用一下它。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{2,}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token string">'The world is a vampire'</span><span class="token punctuation">)</span>

<span class="token comment">// 'the-world-is-a-vampire'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​
7.4. 范畴学</p> <blockquote><p>有兴趣可以了解，作为额外拓展
范畴学（<code>category theory</code>）是数学中的一个抽象分支，能够形式化诸如集合论（<code>set theory</code>）、类型论（<code>type theory</code>）、群论（<code>group theory</code>）以及逻辑学（<code>logic</code>）等数学分支中的一些概念。范畴学主要处理对象（<code>object</code>）、态射（<code>morphism</code>）和变化式（<code>transformation</code>），而这些概念跟编程的联系非常紧密。下图是一些相同的概念分别在不同理论下的形式：</p></blockquote> <p><img src="/assets/img/8-3.7d9f8fd1.png" alt="alt 8-3"></p> <p>在范畴学中，有一个概念叫做...范畴。有着以下这些组件（component）的搜集（collection）就构成了一个范畴：</p> <ol><li>对象的搜集；</li> <li>态射的搜集；</li> <li>态射的组合；</li> <li>identity 这个独特的态射；</li></ol> <p>范畴学抽象到足以模拟任何事物，不过目前我们最关心的还是类型和函数，所以让我们把范畴学运用到它们身上看看。</p> <h4 id="对象的搜集"><a href="#对象的搜集" class="header-anchor">#</a> 对象的搜集</h4> <p>对象就是数据类型，例如 String、Boolean、Number 和 Object 等等。通常我们把数据类型视作所有可能的值的一个集合（set）。像 Boolean 就可以看作是 [true, false] 的集合，Number 可以是所有实数的一个集合。把类型当作集合对待是有好处的，因为我们可以利用集合论（<code>set theory</code>）处理类型。</p> <h4 id="态射的搜集"><a href="#态射的搜集" class="header-anchor">#</a> 态射的搜集</h4> <p>态射是标准的、普通的纯函数。</p> <h4 id="态射的组合"><a href="#态射的组合" class="header-anchor">#</a> 态射的组合</h4> <p>这张图展示了什么是组合：</p> <p><img src="/assets/img/8-4.ce1ca837.png" alt="alt 8-4"></p> <p><img src="/assets/img/8-5.59ac2880.png" alt="alt 8-5"></p> <p>这里有一个具体的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">g</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">.</span>length <span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">===</span> <span class="token number">4</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> isFourLetterWord <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​</p> <h4 id="identity-这个独特的态射"><a href="#identity-这个独特的态射" class="header-anchor">#</a> identity 这个独特的态射</h4> <p>让我们介绍一个名为 id 的实用函数。这个函数接受随便什么输入然后原封不动地返回它：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>​<span class="token keyword">var</span> <span class="token function-variable function">id</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>id 函数跟组合一起使用简直完美。下面这个特性对所有的一元函数（<code>unary function</code>）（一元函数：只接受一个参数的函数） f 都成立：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// identity</span>
<span class="token function">compose</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">==</span> f
<span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​
7.5. 测试</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">​require</span><span class="token punctuation">(</span><span class="token string">'../../support'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ramda'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> accounting <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'accounting'</span><span class="token punctuation">)</span>

<span class="token comment">// 示例数据</span>
<span class="token keyword">var</span> <span class="token constant">CARS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Ferrari FF&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">660</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">700000</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Spyker C12 Zagato&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">650</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">648000</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Jaguar XKR-S&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">550</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">132000</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Audi R8&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">525</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">114200</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Aston Martin One-77&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">1850000</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;Pagani Huayra&quot;</span><span class="token punctuation">,</span> horsepower<span class="token operator">:</span> <span class="token number">700</span><span class="token punctuation">,</span> dollar_value<span class="token operator">:</span> <span class="token number">1300000</span><span class="token punctuation">,</span> in_stock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>

<span class="token comment">// 练习 1:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 _.compose() 重写下面这个函数。提示：_.prop() 是 curry 函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">isLastInStock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> last_car <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">,</span> last_car<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 练习 2:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 _.compose()、_.prop() 和 _.head() 获取第一个 car 的 name</span>
<span class="token keyword">var</span> nameOfFirstCar <span class="token operator">=</span> <span class="token keyword">undefined</span>


<span class="token comment">// 练习 3:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用帮助函数 _average 重构 averageDollarValue 使之成为一个组合</span>
<span class="token keyword">var</span> <span class="token function-variable function">_average</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> xs<span class="token punctuation">)</span> <span class="token operator">/</span> xs<span class="token punctuation">.</span>length <span class="token punctuation">}</span> <span class="token comment">// &lt;- 无须改动</span>

<span class="token keyword">var</span> <span class="token function-variable function">averageDollarValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dollar_values <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span>dollar_value <span class="token punctuation">}</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">_average</span><span class="token punctuation">(</span>dollar_values<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 练习 4:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 compose 写一个 sanitizeNames() 函数，返回一个下划线连接的小写字符串：例如：sanitizeNames([&quot;Hello World&quot;]) //=&gt; [&quot;hello_world&quot;]。</span>

<span class="token keyword">var</span> _underscore <span class="token operator">=</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\W+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token comment">//&lt;-- 无须改动，并在 sanitizeNames 中使用它</span>

<span class="token keyword">var</span> sanitizeNames <span class="token operator">=</span> <span class="token keyword">undefined</span>


<span class="token comment">// 彩蛋 1:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 compose 重构 availablePrices</span>

<span class="token keyword">var</span> <span class="token function-variable function">availablePrices</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> available_cars <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span>
  <span class="token keyword">return</span> available_cars<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> accounting<span class="token punctuation">.</span><span class="token function">formatMoney</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>dollar_value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 彩蛋 2:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 重构使之成为 pointfree 函数。提示：可以使用 _.flip()</span>

<span class="token keyword">var</span> <span class="token function-variable function">fastestCar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sorted <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">car</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> car<span class="token punctuation">.</span>horsepower <span class="token punctuation">}</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span>
  <span class="token keyword">var</span> fastest <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>sorted<span class="token punctuation">)</span>
  <span class="token keyword">return</span> fastest<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">' is the fastest'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>代码见课后习题；</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/xw230429/xw_230429_7.html" class="prev">
            7. JavaScript的运行机制
          </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.8a9ca17e.js" defer></script><script src="/assets/js/3.c46e8d0c.js" defer></script><script src="/assets/js/1.ae8c2f5c.js" defer></script><script src="/assets/js/14.c44a77a0.js" defer></script>
  </body>
</html>
